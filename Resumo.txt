-- # Mongo DB # -- 

Banco de dados NoSQL que armazena documentos e coleções, ou seja, ao invés de armazenar registros em 
tabelas estruturadas em linhas e colunas (SQL) ele armazena dados em documentos dentro de coleções.
A grande diferença é que como não se trata de um DB relacional, não soos obrigados a ter qualquer tipo
de relação entre os documentos armazenados.

É o DB NoSQL mais utilizado atualmente.
O MongoDB vem com uma ferramenta grafica padrão chamada MongoDB compass, mas é pos´sivel usar de formas diferentes
Através do CMD é possível acessar o MongoDB digitando "mongo".
No cmd é possível manipular os dados, por exemplo:

use meubanco (usar o DB meubanco caso exista, se não existe, ele cria)
DB: diz qual banco estamos conectados
help: lista de comandos que podemos usar

> db.pessoas.insert(
{
"nome": "Felicity Jones",
"email": "felicity@gmail.com"
}
)

Acima foi criada uma coleção chamada "pessoas" no banco "meubanco", e foi inserido um documento
neste banco (a inserção da coleção), em SQL seria análogo a registro.
O cmd exibe a mensgaem "WriteResult({ "nInserted" : 1 })" ao inserior o registro acima onde "1" é a quantidade de documentos inseridos.
Os bancos NoSQL não são rigidos, e uma coleção pode ter um documento com 3 atributos enquanto tbm tem outro documento com mais ou menos atributos

> db.pessoas.find() : exibe os documentos registrados na coleção pessoa (o id é gerado pelo proprio mongodb)
> show collections: mostra nossas coleções

Essas alterações feitas no cmd podem ser observadas na ferramenta grafica do MongoDB.

-- # Consultando dados # --
Usando o terminal (cmd) para aprender os comandos (a ferramenta gráfica não necessita de comandos escritos)
cmd > mongo (lembrando que o path para a pasta bin deve estar configurado no windows)

> db.pessoas.insert({}) : inserindo documentos no banco para a coleção pessoas
> db.pessoas.find() : mostrando os documentos da coleção pessoas
> db.pessoas.find().pretty : mostrando os documentos da coleção pessoas formatado
> db.pessoas.find({"nome": "Felicity Jones"}): Mostra exatamente o objeto com o nome procurado
> db.tipos_produtos.insert({"descricao": "Computador"}): Criando a coleção tipos_produtos ao memso tempo que insiro um documento nela
> db.createCollection("acessos"): criando uma coleção vazia, sem nenhum dado
> db.acessos.insert({"usuario": "Marcos", "senha": "12345"}): Populando o documento acima


-- Dados mais complexos
> db.inscricoes.insert({"aluno": "Paula Guerra", "data": new Date(), "curso": {"nome": "Progrmacao para internet"}}): 
O mongoDB usa linguagem Javascritp. por isso podemos usar comandos dele para adicionar ações. Os dados dentro das {} são elemtnos 
JavaScript e comando como new Date() fazem parte de sua sintaxe. Além disso, podemos criar novos documentos dentro de documentos como
é visto no caso de "curso" com um objeto dentro de si.

> db.inscricoes.insert({"aluno": "Fernando", "data": new Date(), "curso": {"nome": "Ciencia da computacao"}, "notas": [9.8, 7.8, 8], "skills": [{"nome": "Python, "nivel": "avançado"},{"nome": "banco de dados", "nivel": "intermediario"}]})
Neste segundo exemplo podemos ver Arrays delimitados por colchetes e objetos dentro de objetos, como dois documentos dentro do Array "skills"
> db.inscricoes.find({"skills.nome": "Phyton"}): Mostra todos os documentos em que em seu "skills" há o valor "Phyton"
> db.inscricoes.find({"skills.nome": "Phyton","skills.nivel": "basico"}): Mostra todos que possuem "skills" python e que também sejam do "Nível" de valor "basico"
> db.inscricoes.find({$or: [{"curso.nome": "Ciencia da computacao"}, {"curso.nome": "programacao"}]}): Traz alunos que façam ciencia da computaçao e/ou alunos que fazem programação (comando $or: [])
> db.inscricoes.find({ "skills.nome": "Phyton", "skills.nivel": { $in: ["avançado", "intermediario"]}}): Traz os alunos que possuem como skill o Phyton e que seu nivel esteja na lista especificada, no caso na lista[avançado, intermediario]

https://docs.mongodb.com/manual/reference/operator/query/ 
A documentação acima mostra os variados tipos de operadores que podem ser usados no MongoDB para FIND.


--# Atualizando dados #--
O comando update recebe dois parametros, o primeiro funciona como o WHERE em bancos SQL e serve para filtrar-mos o/os documento/s o qual queremos atualizar,
o segundo é como o documento deve ficar apos atualizado. O comando update irá atualizar o primeiro documento que encontrar, além disso, irá substituir o documento original pelo novo
especificado no segundo parâmetro, ou seja, se no segundo parâmetro não tiver todas as informações completas do documento, todo o conteudo sera substituido. No exemplo abaixo, qualquer informação
além do no do curso seria perdida.

> db.inscricoes.update({"curso.nome": "Progrmacao para internet"},{"nome.curso": "Programação para Internet"}): Atualizando o nome do curso e corrigindo a escrita errada em programação
> db.inscricoes.remove({"_id": Objectid('s8dhssn98wndh3828")}): deletando o dado do id especificado

Para atualizar um campo especifico sem perder toda a informação do documento:

> db.inscricoes.update({"curso.nome": "Progrmação para internet"}, {$set: {"curso.nome": "Programação para Internet II"}}): o primeiro {} esta localizando o valor a ser mudado, a variavel $set vai ser responsável por 
atualizar o campo com o segundo {} sem deletar todo o documento.

Utilizar o update para atualizar multiplos documentos
> db.inscricoes.update({"curso.nome": "Progrmação para internet"}, {$set: {"curso.nome": "Programação para Internet II"}}, {multi: true}): A sintaxe multi: true faz com que todo documento que puder ser atualizado será, pois por padrão o update só atualiza o primeiro
documento que encontrar.

Atualizando um array (lista)
> db.inscricoes.update({"_id": Objectid('s8dhssn98wndh3828")}, {$push: {notas:6.7}}): $push vai servir para adicionar dados arrays, adicionou a nova nota num array que ja existia
> db.inscricoes.update({"_id": Objectid('s8dhssn98wndh3828")}, {$push: {notas: {$each: [6.7]}}}): Caso precisamos adicionar mais d eum valor em um array, usamos $each (criando uma lista []) em conjunto com $push

https://docs.mongodb.com/manual/reference/operator/update/ : Este lick tem os demais operadores para serem utilizado no update


-- # Ordenação e limitação de dados # --

> db.inscricoes.find({"notas": "8.0}): Encontra todos os alunos que tem alguma nota 8.0
> db.inscricoes.find({"notas": {$gt: 8.0}}): Filtrar dados de uma coleção com valores maiores que 8.0, usamos o operador $gt (greater than)
> db.inscricoes.find({"notas": {$gte: 8.0}}): $gte para maior ou igual a 8.0
> db.inscricoes:findOne({"notas": {$gte: 8.0}}): Mostra apenas um resultado dentre possíveis varios
> db.inscricoesfind().sort({"aluno": 1}): Ordenar os resultados por algum parametro, nesse caso o nome. o .sort() recebe dois valores, o campo "aluno" e o valor "1" ( 1 para crescente e -1 para decrescente). Podemos aplicar dentro de find() qualquer parametro que queremos 
ou deixra vazio para retornar todos os dados.
> db.inscricoesfind().sort({"aluno": 1}).limit(3): A consulta agora se limitara a apenas 3 resultados

https://docs.mongodb.com/manual/reference/operator/query/ : operadores para consultas


-- # Buscando localizações geograficas #--
Aqui usamos dados de latitude e longitude nas aplicações para podermos processar estes dados.

> db.inscricoes.update({"_id": ObjectId("38jdnu9d873hdbiao783b)}, {$set: {"localização": {"endereco" : "Avenida Zunira Borba, 1978"}}}): Atualizando um documento da coleção com endereço
> db.inscricoes.update({"_id": ObjectId("38jdnu9d873hdbiao783b)}, {$set: {"localização": {"endereco" : "Avenida Zunira Borba, 1978", "coordinates": [-20.388008, -54.577545], "type": "Point"}}}) Atualizando um dado e adicionando coordenadas geograficas da latitude e longitude. Para trabalhar
com coordenadas no mongodb precismaos do campo chamado "coordinates" e "type", o primeiro recebe a lista da latitude e longitude e o "type" é o tipo de coordenada, no caos um ponto.

-- Importando dados para meu banco de dados MongoDB
Um arquivo com dados pode ser inserido numa coleção do banco de dados da seguinte forma. A partir do cmd, chegar até o diretório onde esta o arquivo com os dados e ems eguinda:
> mongoimport -d meubanco -c inscricoes --jsonArray < inscricoes.json
mongoimport é o comando que inicia uma importação, "-d meubanco" especifica para qual banco de dados estamos importando, "-c inscricoes" especifica para qual coleção, "--jsonArray" especifica que tipo de arquivo, neste caso, um arquivo json em lista (array), "< inscricoes.json" é o nome do arquivo a ser importado
Da para abrir o cmd direto na pasata tambem clicando com o botão direito nela + shift e escolhendo "abrir powershell".

-- Como saber dados baseados em localidades? (exemplo, alunos que moram mais proximos um dos outros)
Inicialmente devemos informar ao mongoDB qual o campo que deve ser utilizado como indice de busca
Em seguida devemos realizar uma consulta usando agregação para que os calculos sejam alicados

1º > db.inscricoes.createIndex({"localizacao": "2dsphere"}): "2dsphere" indica que sera usado um mapa 2d para traçar localização baseados nos dados de latitude e longitude
2º > db.inscricoes.aggregate(
	[
		{
			$geoNear: {
				"near": {
					"coordinates": [-20.388008, -54,577546], 
					"type": "Point"
				}, 
				"distanceField": "distancia.calculada",
				"spherical": ture, 
				"num": 4
			}
		}
	]
)
Explicando: $geoNear é um comando que indica calculo de localização de proximidade
	    "near" é uma variável de nome qualquer, ele irá receber as coordenadas de algum alvo e seu tipo
	    "near" também vai receber "distanceField" que sera o campo calculado para cada alvo diferente em relação ao primeiro
            "spherical": true é a especificação do mapa global, "num" indica a quantidade de elementos a serem mostrados, nesse caso os alunos
            mais proximos do aluno que teve sua localização utilizada.

O resultado deste algoritmo vai nos mostrar 4 alunos mais proximos do aluno que teve as coordenadas colocadas (o proprio aluno ira aparecer como distancia calculada: 0)
Não foram feitas alteração na tabela, isos é apenas uma consulta

Para ignorar o primeiro resultado que seria a distancia dele mesmo podemos usar $skip 
3º > db.inscricoes.aggregate(
	[
		{
			$geoNear: {
				"near": {
					"coordinates": [-20.388008, -54,577546], 
					"type": "Point"
				}, 
				"distanceField": "distancia.calculada",
				"spherical": ture, 
				"num": 4
			}
		},
                {
                	$skip: 1
		}
	]
).pretty()

OBS: MONGO DB NÃO VEM COM TODOS OS COMANDOS, PRECISEI BAIXAR A FERRAMENTA MONGODB DATABASE TOOLS PARA ADICIONAR OS COMANDOS NO CMD DE IMPORT
OBS2: ao reproduzir estes exemplos o comando "Num": 4 não é identifciado e deve ser substituido por $limit, neste caso ficou assim:
db.inscricoes.aggregate(
	[
		{
			$geoNear: {
				   "near": {
					"coordinates": [-20.388008, -54.577546], 
					"type": "Point"
					}, 
				   "distanceField": "distancia.calculada", 
				   "spherical": true
				  }
		},
		{
			$limit: 4
		}, 
		{
			$skip: 1
		}
	]
).pretty()


Ou

db.inscricoes.aggregate([{$geoNear: {"near": {"coordinates": [-20.388008, -54.577546], "type": "Point"}, "distanceField": "distancia.calculada", "spherical": true}},{$limit: 4}, {$skip: 1}]).pretty()

E foram apresentados 3 resultados, pois apesar do limite ser 4 o primeiro foi skipado

























